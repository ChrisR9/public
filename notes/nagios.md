## Verifying Nagios Config ##
    nagios3 -v /etc/nagios3/nagios.cfg

## Tailing nagios' logfile with human-readable timestamps ##
    tail -f nagios.debug | perl -pe 's/(\d+).\d+/localtime($1)/e'

## Todo ##
- Look into how to chain Nagios hosts, so that a separate Nagios machine can
  be set up out in Amazon to handle alerts from hosts out there without having
  to traverse the firewall.
- Change the NRPE config to log to facility 'local4', then change the
  syslog-ng config so that NRPE log messages go to their own file
- Fix the "check_services_nagios" script so it doesn't include false positive
  matches (it's matching on the grep statement)
- Save SSH keys on EBS volume, restore them when a new machine is brought up

## Changes needed when restarting nagmaster ##
- /opt/nagios/config/corp/servers/nagmaster.cfg - add/edit internal IP for
  nagmaster
- /etc/nagios/nrpe.cfg - add/edit internal IP to allowed_hosts parameter
- Symlink /etc/init.d/nagios-nrpe-server to /etc/init.d/nrpe
- Add the following scripts to /usr/lib/nagios/plugins
  - check_services
  - check_open_files.pl
  - check_cpu_stats.sh (requires 'bc' package)
  - custom_check_procs

## Changes needed when restarting clients ##
- open up access to NRPE checks from whatever IP nagmaster is on currently
- Symlink /etc/init.d/nagios-nrpe-server to /etc/init.d/nrpe

## Config File Tweaks ##
- Base URL for docs: http://nagios.sourceforge.net/docs/3_0
- Setting 'retain_nonstatus_information' to off (0) will cause Nagios to
  re-read it's configuration files in order to get information like IP
  addresses for hosts (objectdefinitions.html)

## Config Directives ##
http://nagios.sourceforge.net/docs/3_0/objectdefinitions.html
- command{} - defines a command that is run to do something; the command could
  go out and get the status of a machine, or it could be a command to send out
  a notification for an event
- contact{} - Identifies someone who should be contact in the event of a
  problem
- contactgroup{} - groups contacts together
- host{} - describes a single host
- hostgroup{} definitions group hosts together for display in the CGI or for
  simplifying configuration.
- service{} - describes a single service
- servicegroup{} definitions group services together for display in the CGI or
  for simplifying configuration.
- timeperiod{} - A list of times that are considered "valid" times for
  notifications and service checks

## Config File Paths ##
If you want to modify parameters for an individual host or service, this is
probably where you want to go.

- /etc/nagios3/corp/ and /etc/nagios3/corp/servers - files with individual
  hosts and services, host and service dependencies, and host/network groups
  for corporate (non-public facing) hosts and services.
- /etc/nagios3/product/ and /etc/nagios3/product/servers - files with individual
  hosts and services, host and service dependencies, and host/network groups
  for production (customer facing) hosts and services.  

## Config File Layout ##
- /etc/nagios3/apache2.conf - Apache configuration for Nagios CGIs
- /etc/nagios3/cgi.cfg - Nagios CGI config; sets assorted permissions for
  users trying to use Nagios via the CGI interface
- /etc/nagios3/commands.cfg - Commands (defined via the 'define command'
  directive) run by the Nagios daemon in order to get data from remote
  machines or carry out actions based on alerts generated by Nagios; this
  would be SNMP commands, NRPE commands, NÐ…CA commands, running the PagerDuty
  script with an alert, and running any of the commands in
  /usr/lib/nagios/plugins
- /etc/nagios3/contacts.cfg - Different contacts and contact groups that are
  used when notification needs to be sent out for a Nagios event.
- /etc/nagios3/htpasswd.users - the HTTP access control file
- /etc/nagios3/nagios.cfg - Main config file for Nagios; calls other config
  files (command.cfg, timperiods.cfg, contacts.cfg, hostgroups.cfg,
  servicegroups.cfg, etc.), and different configuration settings for Nagios
- /etc/nagios3/pagerduty_nagios.cfg - A set of contacts{} and commands{} that
  allow notifications to be sent via PagerDuty
- /etc/nagios3/resource.cfg - a list of "resources", or variables that can be
  used anywhere in Nagios; currenly only one resource defined, the path to the
  Nagios plugins directory
- /etc/nagios3/stylesheets - Cascading Style Sheets for the CGI web interface
- /etc/nagios3/templates - Generic monitoring templates that are used in other
  configuration files, i.e. they're not used directly.

## Webpage Descriptions ##
- Host Detail page lists all of the monitored hosts
- Service Detail page lists all of the monitored services, along with the
  hosts that they are being monitored on

## Configuring Nagios ##
- By default, /opt/nagios/config/conf.d holds all of the per-host/per-service
  config files

## Nagios Documentation ## 
- Nagios Core Table of Contents - http://tinyurl.com/8yr66wk
- NRPE setup/config/testing: http://nagios.sourceforge.net/docs/nrpe/NRPE.pdf

## Amazon/RightScale Documentation ##
- Amazon Using regions/availability zones: http://tinyurl.com/ccggl47
- Amazon Regions/availability zones FAQ: http://tinyurl.com/bp4cm3b
- RightScale tags: http://tinyurl.com/bwlyvae


## Symlink Farm ##

    # nagios config in /etc
    mv /etc/nagios3 /etc/nagios3.orig
    ln -s /opt/nagios/config /etc/nagios3
    # nagios files in /usr/share
    mv /usr/share/nagios3 /usr/share/nagios3.orig
    ln -s /opt/nagios/share /usr/share/nagios3
    # nagios CGI scripts
    mv /usr/lib/cgi-bin/nagios3 /usr/lib/cgi-bin/nagios3.orig
    ln -s /opt/nagios/cgi-bin /usr/lib/cgi-bin/nagios3

# vim: filetype=markdown tabstop=2
