#!/bin/bash

# ANSI escape codes: http://en.wikipedia.org/wiki/ANSI_escape_code

# host colors
H_GREEN="\[\e[0;32;40m\]"
H_BLUE="\[\e[1;34;40m\]"

# user colors
U_CYAN="\[\e[0;36;40m\]"
U_MAGENTA="\[\e[0;35;40m\]"
U_YELLOW="\[\e[0;33;40m\]"

# list of hostnames that receive special colors
HOSTNAMES="pig|pigwidgeon|grom|lagrange|observer|yabloko"
# list of usernames that receive special colors
SERVICE_USERS="jenkins|icinga|icinga-cmd"

set_ps1 () {
    LAST_CMD=$?
    ### Set up PS1_HOST
    if [ $(echo ${HOSTNAME} | egrep -c "${HOSTNAMES}") -gt 0 ]; then
        HOST_COLOR=${H_GREEN}
    else
        HOST_COLOR=${H_BLUE}
    fi
    # speshul case for grom
    if [ $(echo ${HOSTNAME} | egrep -c "grom") -gt 0 ]; then
        HOST_STRING="гром"
    else
        HOST_STRING="\h"
    fi
    # HOST_COLOR + HOST_STRING = PS1_HOST
    if [ ${LAST_CMD} -eq 0 ]; then
        PS1_HOST="[${HOST_COLOR}${HOST_STRING}\[\e[0m\]]"
    else
        PS1_HOST="[\[\e[0;31;40m\]${HOST_STRING}\[\e[0m\]]"
    fi
    ### Set up PS1_USER
    if [ $(echo ${USER} | egrep -c "${SERVICE_USERS}") -gt 0 ]; then
        PS1_USER="[${U_YELLOW}\u\[\e[0m\]"
    else
        PS1_USER="[${U_CYAN}\u\[\e[0m\]"
    fi
    ### Set up PS1_HOST
    PS1_PATH=" \[\e[0;35;40m\]\W\[\e[0m\]]\\$ "
    PS1="${PS1_HOST}${PS1_USER}${PS1_PATH}"
}
unset PS3 PS1_HOST PS1_USER PS1_PATH
PROMPT_COMMAND=set_ps1
PS2="\[\e[0;1m\]>\[\e[0m\] "
PS4="\[\e[1;32m\]+\[\e[0m\] "
export PS1 PS2 PS4

# vi: set ft=sh sw=4 ts=4
# fin!
